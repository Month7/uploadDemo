# uploadDemo

一个断点续传的小demo

前端vue 后台express

基本原理说明：

接口：

### '/fileMd5' 校验文件完整性

接收 post 参数

* fileName 文件名

* fileMd5 文件md5值

返回值

{

code: 状态码        40010： 文件已经存在  40001:  文件夹存在，之前上传过但未上传完毕 200:    正常

msg:  状态码说明

data:  已存在的文件列表

}


### '/upload' 文件上传

接收 post 参数

* formData

* total 文件总片数

* idx 当前分片的index

* data 当前分片

* filename 文件名称

返回值

{

code: 状态码        40010： 上传完毕   200:    正常

msg:  状态码说明

}

### '/merge'  合并文件

接收 get 参数

* filename 文件名称

返回值
{

code: 状态码        40001： 合并异常   200:    正常

msg:  状态码说明

}

## 基本流程

在input file选择文件后，点击上传，客户端首先根据文件名称对文件进行md5加密，调用 '/fileMd5' 接口 将文件名和md5后的值发送到服务端

如果服务端返回 40010 说明文件已存在 不用重新上传 直接秒传

如果服务端返回 40001 说明文件上传过，但未上传完毕，服务端将返回已上传过的文件列表 客户端调用upload方法 切片并上传（不上传已上传过的文件）

如果服务端返回 200 说明是第一次上传 客户端调用upload方法 切片并上传

upload方法首先 使用h5 的 file  slice API对文件进行切片，然后对每一片进行上传（先判断是否在已上传的文件列表里，在则不上传）递归调用upload方法，

直到 服务端返回 40010 说明上传完毕，调用 '/merge'接口 进行文件合并 至此上传完毕

#### 暂停的实现

目前暂停的实现主要是在客户端完成的

点击暂停后，parseFlag变量置为false upload方法调用时判断parseFlag变量 若为false 不递归调用自身 从而实现暂停

#### 断网情况的处理

在ajax请求的error回调里 调用暂停方法，不过需要保存暂停的数据。之后与暂停同理。
